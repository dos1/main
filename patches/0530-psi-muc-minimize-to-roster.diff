--- a/options/default.xml
+++ b/options/default.xml
@@ -117,6 +117,7 @@
 				<scaled-message-icons type="bool">false</scaled-message-icons>
 				<warn-before-clear type="bool">true</warn-before-clear>
 				<css type="QString" />
+				<hide-when-closing type="bool">false</hide-when-closing>
 			</chat>
 			<save>
 				<toolbars-state type="QByteArray"/>
@@ -547,9 +548,13 @@ QLineEdit#le_status_text {
 				<scroll-up type="QKeySequence" comment="Scroll up">Shift+PgUp</scroll-up>
 				<scroll-down type="QKeySequence" comment="Scroll down">Shift+PgDown</scroll-down>
 				<close type="QVariantList" comment="Close the current window/tab">
-					<item type="QKeySequence">Esc</item>
+					<item type="QKeySequence">Ctrl+Q</item>
 					<item type="QKeySequence">Ctrl+W</item>
 				</close>
+				<hide type="QVariantList" comment="Hide the current window/tab">
+					<item type="QKeySequence">ESC</item>
+					<item type="QKeySequence">Alt+H</item>
+				</hide>
 				<history type="QKeySequence" comment="Open the message history">Ctrl+H</history>
 				<user-info type="QKeySequence" comment="Show the user info of the contact">Ctrl+I</user-info>
 			</common>
--- a/src/chatdlg.cpp
+++ b/src/chatdlg.cpp
@@ -173,6 +173,10 @@ void ChatDlg::initActions()
 	addAction(act_close_);
 	connect(act_close_, SIGNAL(triggered()), SLOT(close()));
 
+	act_hide_ = new QAction(this);
+	addAction(act_hide_);
+	connect(act_hide_, SIGNAL(triggered()), SLOT(hideTab()));
+
 	act_scrollup_ = new QAction(this);
 	addAction(act_scrollup_);
 	connect(act_scrollup_, SIGNAL(triggered()), chatView(), SLOT(scrollUp()));
@@ -193,6 +197,7 @@ void ChatDlg::setShortcuts()
 	act_send_->setShortcuts(ShortcutManager::instance()->shortcuts("chat.send"));
 	act_scrollup_->setShortcuts(ShortcutManager::instance()->shortcuts("common.scroll-up"));
 	act_scrolldown_->setShortcuts(ShortcutManager::instance()->shortcuts("common.scroll-down"));
+	act_hide_->setShortcuts(ShortcutManager::instance()->shortcuts("common.hide"));
 
 	if(!isTabbed()) {
 		act_close_->setShortcuts(ShortcutManager::instance()->shortcuts("common.close"));
--- a/src/chatdlg.h
+++ b/src/chatdlg.h
@@ -172,6 +172,7 @@ private:
 	QAction* act_scrollup_;
 	QAction* act_scrolldown_;
 	QAction* act_close_;
+	QAction* act_hide_;
 
 	int pending_;
 	bool keepOpen_;
--- a/src/contactlistgroup.h
+++ b/src/contactlistgroup.h
@@ -93,7 +93,8 @@ public:
 		SpecialType_General,
 		SpecialType_NotInList,
 		SpecialType_Transports,
-		SpecialType_MUCPrivateChats
+		SpecialType_MUCPrivateChats,
+		SpecialType_Conference
 	};
 
 	virtual bool isSpecial() const;
--- a/src/contactlistgroupmenu.cpp
+++ b/src/contactlistgroupmenu.cpp
@@ -35,6 +35,8 @@
 #include "statusdlg.h"
 #include "xmpp_tasks.h"
 
+#include "groupchatdlg.h"
+
 class ContactListGroupMenu::Private : public QObject
 {
 	Q_OBJECT
@@ -52,6 +54,9 @@ class ContactListGroupMenu::Private : public QObject
 	QAction* actionAuthRequest_;
 	QAction* actionAuthRemove_;
 	QAction* actionCustomStatus_;
+	QAction* actionMucHide_;
+	QAction* actionMucShow_;
+	QAction* actionMucLeave_;
 
 public:
 	Private(ContactListGroupMenu* menu, ContactListGroup* _group)
@@ -94,23 +99,41 @@ public:
 		connect(addGroupAction_, SIGNAL(triggered()), SLOT(addGroup()));
 #endif
 
+		actionMucHide_ = new IconAction(tr("Hide All"), this, "psi/action_muc_hide");
+		connect(actionMucHide_, SIGNAL(triggered()), SLOT(mucHide()));
+
+		actionMucShow_ = new IconAction(tr("Show All"), this, "psi/action_muc_show");
+		connect(actionMucShow_, SIGNAL(triggered()), SLOT(mucShow()));
+
+		actionMucLeave_ = new IconAction(tr("Leave All"), this, "psi/action_muc_leave");
+		connect(actionMucLeave_, SIGNAL(triggered()), SLOT(mucLeave()));
+
 		updateActions();
 
+		if (ContactListGroup::SpecialType_Conference != group->specialGroupType()) {
 #ifdef YAPSI
-		menu->addAction(renameAction_);
-		menu->addAction(removeGroupAndContactsAction_);
-		menu->addAction(addGroupAction_);
+			menu->addAction(renameAction_);
+			menu->addAction(removeGroupAndContactsAction_);
+			menu->addAction(addGroupAction_);
 #else
-		menu->addAction(renameAction_);
-		menu->addAction(sendMessageAction_);
-		menu->addAction(actionCustomStatus_);
-		menu->addSeparator();
-		authMenu_ = menu->addMenu(tr("Authorization"));
-		authMenu_->addAction(actionAuth_);
-		authMenu_->addAction(actionAuthRequest_);
-		authMenu_->addAction(actionAuthRemove_);
-		menu->addAction(removeGroupWithoutContactsAction_);
-		menu->addAction(removeGroupAndContactsAction_);
+			menu->addAction(renameAction_);
+			menu->addAction(sendMessageAction_);
+			menu->addAction(actionCustomStatus_);
+			menu->addSeparator();
+			authMenu_ = menu->addMenu(tr("Authorization"));
+			authMenu_->addAction(actionAuth_);
+			authMenu_->addAction(actionAuthRequest_);
+			authMenu_->addAction(actionAuthRemove_);
+			menu->addAction(removeGroupWithoutContactsAction_);
+			menu->addAction(removeGroupAndContactsAction_);
+		}
+		else {
+			menu->addAction(actionMucHide_);
+			menu->addAction(actionMucShow_);
+			menu->addAction(actionMucLeave_);
+			menu->addSeparator();
+			menu->addAction(actionCustomStatus_);
+		}
 #endif
 	}
 
@@ -129,6 +152,41 @@ private slots:
 #endif
 	}
 
+	void mucHide()
+	{
+		PsiAccount *pa = group->contacts().first()->account();
+		foreach (QString gc, pa->groupchats()) {
+			Jid j(gc);
+			GCMainDlg *gcDlg = pa->findDialog<GCMainDlg*>(j.bare());
+			if (gcDlg && (gcDlg->isTabbed() || !gcDlg->isHidden()))
+				gcDlg->hideTab();
+		}
+	}
+
+	void mucShow()
+	{
+		PsiAccount *pa = group->contacts().first()->account();
+		foreach (QString gc, pa->groupchats()) {
+			Jid j(gc);
+			GCMainDlg *gcDlg = pa->findDialog<GCMainDlg*>(j.bare());
+			if (gcDlg) {
+				gcDlg->ensureTabbedCorrectly();
+				gcDlg->bringToFront();
+			}
+		}
+	}
+
+	void mucLeave()
+	{
+		PsiAccount *pa = group->contacts().first()->account();
+		foreach (QString gc, pa->groupchats()) {
+			Jid j(gc);
+			GCMainDlg *gcDlg = pa->findDialog<GCMainDlg*>(j.bare());
+			if (gcDlg)
+				gcDlg->close();
+		}
+	}
+
 	void rename()
 	{
 		if (!group)
--- a/src/contactlistmodel.cpp
+++ b/src/contactlistmodel.cpp
@@ -555,6 +555,12 @@ QVariant ContactListModel::contactData(const PsiContact* contact, int role) cons
 		QPixmap pix = contact->account()->avatarFactory()->getAvatar(contact->jid());
 		return QVariant(pix);
 	}
+	else if (role == IsMucRole) {
+		return QVariant(contact->userListItem().isConference());
+	}
+	else if (role == MucMessagesRole) {
+		return QVariant(contact->userListItem().pending());
+	}
 #ifdef YAPSI
 	else if (role == Qt::ForegroundRole) {
 		return QVariant(Ya::statusColor(contact->status().type()));
--- a/src/contactlistmodel.h
+++ b/src/contactlistmodel.h
@@ -84,6 +84,8 @@ public:
 		ClientRole = Qt::UserRole + 26,
 		TuneRole = Qt::UserRole + 27,
 		AvatarRole = Qt::UserRole + 28,
+		IsMucRole = Qt::UserRole + 29,
+		MucMessagesRole = Qt::UserRole + 30,
 
 		// groups
 		ExpandedRole = Qt::UserRole + 12,
--- a/src/contactlistnestedgroup.cpp
+++ b/src/contactlistnestedgroup.cpp
@@ -312,6 +312,9 @@ ContactListGroup* ContactListNestedGroup::specialGroupFor(PsiContact* contact)
 	else if (contact->isAgent()) {
 		type = ContactListGroup::SpecialType_Transports;
 	}
+	else if (contact->isConference()) {
+		type = ContactListGroup::SpecialType_Conference;
+	}
 	else if (contact->noGroups()) {
 		type = ContactListGroup::SpecialType_General;
 	}
--- a/src/contactlistspecialgroup.cpp
+++ b/src/contactlistspecialgroup.cpp
@@ -45,6 +45,10 @@ ContactListSpecialGroup::ContactListSpecialGroup(ContactListModel* model, Contac
 		name_ += "mucprivatechats";
 		displayName_ = tr("Private messages");
 		break;
+	case SpecialType_Conference:
+		name_ += "conferences";
+		displayName_ = tr("Conferences");
+		break;
 	default:
 		Q_ASSERT(false);
 	}
@@ -102,8 +106,9 @@ bool ContactListSpecialGroup::compare(const ContactListItem* other) const
 		rank[SpecialType_General]         = 0;
 		rank[SpecialType_None]            = 1;
 		rank[SpecialType_MUCPrivateChats] = 2;
-		rank[SpecialType_Transports]      = 3;
+		rank[SpecialType_Conference]      = 3;
 		rank[SpecialType_NotInList]       = 4;
+		rank[SpecialType_Transports]      = 5;
 		Q_ASSERT(rank.contains(specialGroupType()));
 		Q_ASSERT(rank.contains(group->specialGroupType()));
 		return rank[specialGroupType()] < rank[group->specialGroupType()];
--- a/src/eventdlg.cpp
+++ b/src/eventdlg.cpp
@@ -1400,6 +1400,8 @@ void EventDlg::keyPressEvent(QKeyEvent *e)
 		close();
 	else if(ShortcutManager::instance()->shortcuts("message.send").contains(key))
 		doSend();
+	else if(ShortcutManager::instance()->shortcuts("common.hide").contains(key))
+		hide();
 	else
 		e->ignore();
 }
--- a/src/groupchatdlg.cpp
+++ b/src/groupchatdlg.cpp
@@ -214,7 +214,7 @@ public:
 #endif
 	QAction *act_send, *act_scrollup, *act_scrolldown, *act_close;
 
-	QAction *act_mini_cmd, *act_nick;
+	QAction *act_mini_cmd, *act_nick, *act_hide;
 
 	MCmdSimpleSite mCmdSite;
 	MCmdManager mCmdManager;
@@ -223,6 +223,7 @@ public:
 
 	QMenu *pm_settings;
 	int pending;
+	int hPending; // highlight pending
 	bool connecting;
 
 	QStringList hist;
@@ -602,6 +603,7 @@ GCMainDlg::GCMainDlg(PsiAccount *pa, const Jid &j, TabManager *tabManager)
 	d->mucManager = new MUCManager(account()->client(), jid());
 
 	d->pending = 0;
+	d->hPending = 0;
 	d->connecting = false;
 
 	d->histAt = 0;
@@ -722,6 +724,9 @@ GCMainDlg::GCMainDlg(PsiAccount *pa, const Jid &j, TabManager *tabManager)
 	d->act_close = new QAction(this);
 	addAction(d->act_close);
 	connect(d->act_close,SIGNAL(triggered()), SLOT(close()));
+	d->act_hide = new QAction(this);
+	addAction(d->act_hide);
+	connect(d->act_hide,SIGNAL(triggered()), SLOT(hideTab()));
 	d->act_scrollup = new QAction(this);
 	addAction(d->act_scrollup);
 	connect(d->act_scrollup,SIGNAL(triggered()), SLOT(scrollUp()));
@@ -844,6 +849,7 @@ void GCMainDlg::setShortcuts()
 	} else {
 		d->act_close->QAction::setShortcuts (QList<QKeySequence>());
 	}
+	d->act_hide->setShortcuts(ShortcutManager::instance()->shortcuts("common.hide"));
 	d->act_scrollup->setShortcuts(ShortcutManager::instance()->shortcuts("common.scroll-up"));
 	d->act_scrolldown->setShortcuts(ShortcutManager::instance()->shortcuts("common.scroll-down"));
 	d->act_mini_cmd->setShortcuts(ShortcutManager::instance()->shortcuts("chat.quick-command"));
@@ -862,6 +868,8 @@ void GCMainDlg::scrollDown()
 void GCMainDlg::closeEvent(QCloseEvent *e)
 {
 	e->accept();
+	if (d->state != Private::Connected)
+		account()->groupChatLeave(d->dlg->jid().domain(),d->dlg->jid().node());
 }
 
 void GCMainDlg::deactivated()
@@ -877,6 +885,12 @@ void GCMainDlg::activated()
 
 	if(d->pending > 0) {
 		d->pending = 0;
+		d->hPending = 0;
+		UserListItem* u = account()->find(d->dlg->jid().bare());
+		if (u) {
+			u->setPending(d->pending, d->hPending);
+			account()->updateEntry(*u);
+		}
 		invalidateTab();
 	}
 	doFlash(false);
@@ -1360,6 +1374,14 @@ void GCMainDlg::presence(const QString &nick, const Status &s)
 	if (nick == d->self) {
 		if(s.isAvailable())
 			setStatusTabIcon(s.type());
+		UserListItem* u = account()->find(d->dlg->jid().bare());
+		if(u) {
+			Resource r;
+			r.setName("Muc");
+			r.setStatus(s);
+			u->userResourceList().replace(0, r);
+			account()->updateEntry(*u);
+		}
 		// Update configuration dialog
 		if (d->configDlg) {
 			d->configDlg->setRoleAffiliation(s.mucItem().role(),s.mucItem().affiliation());
@@ -1639,6 +1661,7 @@ void GCMainDlg::joined()
 		setConnecting();
 		appendSysMsg(tr("Connected."), true);
 	}
+	account()->addMucItem(d->dlg->jid().bare());
 }
 
 void GCMainDlg::setPassword(const QString& p)
@@ -1710,6 +1733,13 @@ void GCMainDlg::appendMessage(const Message &m, bool alert)
 	// if we're not active, notify the user by changing the title
 	if(!isActiveTab() && !mv.isLocal()) {
 		++d->pending;
+		if(alert)
+			++d->hPending;
+		UserListItem* u = account()->find(d->dlg->jid().bare());
+		if (u) {
+			u->setPending(d->pending, d->hPending);
+			account()->updateEntry(*u);
+		}
 		invalidateTab();
 	}
 
--- a/src/historydlg.cpp
+++ b/src/historydlg.cpp
@@ -234,7 +234,8 @@ void HistoryDlg::loadContacts()
 	ui_.msgLog->clear();
 	foreach (PsiContact* contact, d->pa->contactList())
 	{
-		if(contact->isPrivate()
+		if(contact->isConference()
+		|| contact->isPrivate()
 		|| jids_.contains(contact->jid().bare()))
 			continue;
 
--- a/src/mucjoindlg.cpp
+++ b/src/mucjoindlg.cpp
@@ -159,6 +159,8 @@ void MUCJoinDlg::doJoin()
 
 	GCMainDlg *gc = account_->findDialog<GCMainDlg*>(j.bare());
 	if (gc) {
+		if(gc->isHidden() && !gc->isTabbed())
+			gc->ensureTabbedCorrectly();
 		gc->bringToFront();
 		if (gc->isInactive()) {
 			if(gc->jid() != j)
@@ -198,6 +200,7 @@ void MUCJoinDlg::joined()
 
 	closeDialogs(this);
 	deleteLater();
+	account_->addMucItem(jid_.bare());
 }
 
 void MUCJoinDlg::error(int, const QString &str)
--- a/src/psiaccount.cpp
+++ b/src/psiaccount.cpp
@@ -640,10 +640,11 @@ public:
 	void removeEntry(const Jid& jid)
 	{
 		PsiContact* contact = findContact(jid);
-		Q_ASSERT(contact);
-		delete contact;
-		emit account->removeContact(jid);
-
+		if (contact) {
+			Q_ASSERT(contact);
+			delete contact;
+			emit account->removeContact(jid);
+		}
 		updateOnlineContactsCount();
 	}
 
@@ -3863,6 +3864,14 @@ void PsiAccount::actionDefault(const Jid &j)
 
 	if(d->eventQueue->count(u->jid()) > 0)
 		openNextEvent(*u, UserAction);
+	else if (groupchats().contains(j.full()))
+	{
+		TabbableWidget *tab = findDialog<TabbableWidget*>(Jid(j.full()));
+		if(tab) {
+			tab->ensureTabbedCorrectly();
+			tab->bringToFront();
+		}
+	}
 	else {
 		if(PsiOptions::instance()->getOption("options.messages.default-outgoing-message-type").toString() == "message")
 			actionSendMessage(u->jid());
@@ -4837,7 +4846,8 @@ void PsiAccount::handleEvent(const PsiEvent::Ptr &e, ActivationType activationTy
 #endif
 				c->incomingMessage(m);
 				soundType = eChat2;
-				if(o->getOption("options.ui.chat.alert-for-already-open-chats").toBool() && !c->isActiveTab()) {
+				if((o->getOption("options.ui.chat.alert-for-already-open-chats").toBool() && !c->isActiveTab())
+					|| (c->isTabbed() && c->getManagingTabDlg()->isHidden()) ) {
 					// to alert the chat also, we put it in the queue
 					me->setSentToChatWindow(true);
 				}
@@ -5024,6 +5034,7 @@ UserListItem* PsiAccount::addUserListItem(const Jid& jid, const QString& nick)
 	u->setInList(false);
 	u->setAvatarFactory(avatarFactory());
 	u->setName(nick);
+	u->setConference(groupchats().contains(jid.full()));
 
 	// is it a private groupchat?
 	Jid j = u->jid();
@@ -5039,6 +5050,21 @@ UserListItem* PsiAccount::addUserListItem(const Jid& jid, const QString& nick)
 		u->userResourceList().append(ur);
 	}
 
+	if(u->isConference()) {
+		// make a resource so the contact appears online
+		QString name = j.node();
+		UserResource ur;
+		foreach(ConferenceBookmark c, d->bookmarkManager->conferences())
+		{
+			if(c.jid().full() == j.bare()) name = c.name();
+		}
+		u->setInList(true);
+		u->setName(name);
+		ur.setName("Muc");
+		ur.setStatus(status());
+		u->userResourceList().append(ur);
+	}
+
 	// treat it like a push  [pushinfo]
 	//VCard info;
 	//if(readUserInfo(item->jid, &info) && !info.field[vNickname].isEmpty())
@@ -5053,6 +5079,20 @@ UserListItem* PsiAccount::addUserListItem(const Jid& jid, const QString& nick)
 	return u;
 }
 
+void PsiAccount::addMucItem(const Jid& jid)
+{
+	if (jid.isEmpty())
+		return;
+	UserListItem *u = find(jid);
+	if (u) {
+		d->removeEntry(jid);
+		d->userList.removeAll(u);
+	}
+	if (!d->groupchats.contains(jid.bare()))
+		d->groupchats += jid.bare();
+	addUserListItem(jid.bare(), "");
+}
+
 // put an event into the event queue, and update the related alerts
 void PsiAccount::queueEvent(const PsiEvent::Ptr &e, ActivationType activationType)
 {
@@ -5145,8 +5185,12 @@ void PsiAccount::openNextEvent(ActivationType activationType)
 	}
 
 	UserListItem *u = find(e->jid());
-	if(!u)
-		return;
+	if(!u) {
+		u = new UserListItem();
+		u->setJid(e->jid());
+		u->setInList(false);
+		d->userList.append(u);
+	}
 	openNextEvent(*u, activationType);
 }
 
@@ -5335,9 +5379,9 @@ ChatDlg* PsiAccount::openChat(const Jid& j, ActivationType activationType)
 
 void PsiAccount::chatMessagesRead(const Jid &j)
 {
-	if(PsiOptions::instance()->getOption("options.ui.chat.alert-for-already-open-chats").toBool()) {
+//	if(PsiOptions::instance()->getOption("options.ui.chat.alert-for-already-open-chats").toBool()) {
 		processChats(j);
-	}
+//	}
 }
 
 void PsiAccount::logEvent(const Jid &j, const PsiEvent::Ptr &e)
@@ -5359,17 +5403,6 @@ void PsiAccount::edb_finished()
 void PsiAccount::openGroupChat(const Jid &j, ActivationType activationType)
 {
 #ifdef GROUPCHAT
-	QString str = j.bare();
-	bool found = false;
-	for(QStringList::ConstIterator it = d->groupchats.begin(); it != d->groupchats.end(); ++it) {
-		if((*it) == str) {
-			found = true;
-			break;
-		}
-	}
-	if(!found)
-		d->groupchats += str;
-
 	GCMainDlg *w = new GCMainDlg(this, j, d->tabManager);
 	w->setPassword(d->client->groupChatPassword(j.domain(), j.node()));
 	connect(w, SIGNAL(aSend(const Message &)), SLOT(dj_sendMessage(const Message &)));
@@ -5409,8 +5442,14 @@ void PsiAccount::groupChatSetStatus(const QString &host, const QString &room, co
 
 void PsiAccount::groupChatLeave(const QString &host, const QString &room)
 {
-	d->groupchats.removeAll(room + '@' + host);
+	Jid j(room + '@' + host);
+	d->groupchats.removeAll(j.bare());
 	d->client->groupChatLeave(host, room);
+	UserListItem *u = find(j);
+	if (u) {
+		d->removeEntry(j);
+		d->userList.removeAll(u);
+	}
 }
 
 GCContact *PsiAccount::findGCContact(const Jid &j) const
--- a/src/psiaccount.h
+++ b/src/psiaccount.h
@@ -268,6 +268,7 @@ public:
 	class xmlRingElem { public: int type; QDateTime time; QString xml; };
 	QList< xmlRingElem > dumpRingbuf();
 	void clearRingbuf();
+	void addMucItem(const Jid&);
 
 signals:
 	void accountDestroyed();
--- a/src/psicontact.cpp
+++ b/src/psicontact.cpp
@@ -369,7 +369,8 @@ bool PsiContact::isDragEnabled() const
 {
 	return isEditable()
 	       && !isPrivate()
-	       && !isAgent();
+	       && !isAgent()
+	       && !isConference();
 }
 
 /**
@@ -950,6 +951,11 @@ bool PsiContact::isAgent() const
 	return userListItem().isTransport();
 }
 
+bool PsiContact::isConference() const
+{
+	return userListItem().isConference();
+}
+
 bool PsiContact::inList() const
 {
 	return userListItem().inList();
--- a/src/psicontact.h
+++ b/src/psicontact.h
@@ -55,6 +55,7 @@ public:
 	virtual bool isAgent() const;
 	virtual bool inList() const;
 	virtual bool isPrivate() const;
+	virtual bool isConference() const;
 	virtual bool noGroups() const;
 	virtual bool authorized() const;
 	virtual bool authorizesToSeeStatus() const;
--- a/src/psicontactlistviewdelegate.cpp
+++ b/src/psicontactlistviewdelegate.cpp
@@ -333,7 +333,9 @@ void PsiContactListViewDelegate::drawContact(QPainter* painter, const QStyleOpti
 			txtRect.setHeight(r.height() - txtRect.height());
 			o.font.setPointSize(qMax(o.font.pointSize()-2, 7));
 			o.fontMetrics = QFontMetrics(o.font);
+			painter->save();
 			drawText(painter, o, txtRect, statusMsg, index);
+			painter->restore();
 		}
 	}
 	else {
@@ -343,9 +345,15 @@ void PsiContactListViewDelegate::drawContact(QPainter* painter, const QStyleOpti
 		drawText(painter, o, r, text, index);
 	}
 
+	bool isMuc = index.data(ContactListModel::IsMucRole).toBool();
+	QString mucMessages;
+	if(isMuc)
+		mucMessages = index.data(ContactListModel::MucMessagesRole).toString();
+
 	QRect iconRect(r);
 	QList<QPixmap> rightPixs;
 	QList<int> rightWidths;
+	if(!isMuc) {
 	if (showClientIcons_) {
 		const QList<QPixmap> pixList = this->clientPixmap(index);
 
@@ -385,18 +393,23 @@ void PsiContactListViewDelegate::drawContact(QPainter* painter, const QStyleOpti
 		rightPixs.push_back(pix);
 		rightWidths.push_back(pix.width());
 	}
+	}
 
-	if(rightPixs.isEmpty())
+	if(rightPixs.isEmpty() && mucMessages.isEmpty())
 		return;
 
 	int sumWidth = 0;
-	foreach (int w, rightWidths) {
-		sumWidth += w;
+	if(isMuc)
+		sumWidth = fontMetrics_->width(mucMessages);
+	else {
+		foreach (int w, rightWidths) {
+			sumWidth += w;
+		}
+		sumWidth+=rightPixs.count();
 	}
 	QColor bgc = (option.state & QStyle::State_Selected) ? palette.color(QPalette::Highlight) : palette.color(QPalette::Base);
 	QColor tbgc = bgc;
 	tbgc.setAlpha(0);
-	sumWidth+=rightPixs.count();
 	QLinearGradient grad(r.right() - sumWidth - 20, 0, r.right() - sumWidth, 0);
 	grad.setColorAt(0, tbgc);
 	grad.setColorAt(1, bgc);
@@ -405,10 +418,16 @@ void PsiContactListViewDelegate::drawContact(QPainter* painter, const QStyleOpti
 	gradRect.setLeft(gradRect.right() - sumWidth - 20);
 	painter->fillRect(gradRect, tbakBr);
 
-	for (int i=0; i<rightPixs.size(); i++) {
-		const QPixmap pix = rightPixs[i];
-		iconRect.setRight(iconRect.right() - pix.width() -1);
-		painter->drawPixmap(iconRect.topRight(), pix);
+	if(isMuc) {
+		iconRect.setLeft(iconRect.right() - sumWidth - 1);
+		painter->drawText(iconRect, mucMessages);
+	}
+	else {
+		for (int i=0; i<rightPixs.size(); i++) {
+			const QPixmap pix = rightPixs[i];
+			iconRect.setRight(iconRect.right() - pix.width() -1);
+			painter->drawPixmap(iconRect.topRight(), pix);
+		}
 	}
 
 #if 0
--- a/src/psicontactmenu.cpp
+++ b/src/psicontactmenu.cpp
@@ -47,6 +47,8 @@
 #include "yaprofile.h"
 #endif
 
+#include "groupchatdlg.h"
+
 //----------------------------------------------------------------------------
 // GroupMenu
 //----------------------------------------------------------------------------
@@ -251,6 +253,10 @@ public:
 	QAction* gpgUnassignKeyAction_;
 	QAction* vcardAction_;
 	QAction* historyAction_;
+	QAction* mucHideAction_;
+	QAction* mucShowAction_;
+	QAction* mucLeaveAction_;
+
 #endif
 
 public:
@@ -314,6 +320,7 @@ public:
 		menu->addAction(blockAction_);
 		menu_->addSeparator();
 		menu_->addAction(disableMoodNotificationsAction_);
+		updateActions();
 #else
 		addAuthAction_ = new IconAction(tr("Add/Authorize to Contact List"), this, "psi/addContact");
 		connect(addAuthAction_, SIGNAL(triggered()), SLOT(addAuth()));
@@ -405,48 +412,68 @@ public:
 		activeChatsMenu_->setActiveChatsMode(true);
 		connect(activeChatsMenu_, SIGNAL(resourceActivated(PsiContact*, const XMPP::Jid&)), SLOT(openActiveChat(PsiContact*, const XMPP::Jid&)));
 
-		menu_->addAction(addAuthAction_);
-		menu_->addAction(transportLogonAction_);
-		menu_->addAction(transportLogoffAction_);
-		menu_->addSeparator();
-		menu_->addAction(receiveIncomingEventAction_);
-		menu_->addSeparator();
-		msgMenu_ = menu_->addMenu(IconsetFactory::icon("psi/sendMessage").icon(), tr("Send &Message"));
-		msgMenu_->addAction(sendMessageAction_);
-		msgMenu_->addMenu(sendMessageToMenu_);
-		msgMenu_->addAction(openChatAction_);
-		msgMenu_->addMenu(openChatToMenu_);
-		menu_->addAction(openWhiteboardAction_);
-		menu_->addMenu(openWhiteboardToMenu_);
-		menu_->addMenu(executeCommandMenu_);
-		menu_->addMenu(activeChatsMenu_);
-		if(AvCallManager::isSupported()) {
-			menu_->addAction(voiceCallAction_);
+		mucHideAction_ = new IconAction(tr("Hide"), this, "psi/action_muc_hide");
+		connect(mucHideAction_, SIGNAL(triggered()), SLOT(mucHide()));
+		mucHideAction_->setShortcuts(ShortcutManager::instance()->shortcuts("common.hide"));
+
+		mucShowAction_ = new IconAction(tr("Show"), this, "psi/action_muc_show");
+		connect(mucShowAction_, SIGNAL(triggered()), SLOT(mucShow()));
+		mucShowAction_->setShortcuts(ShortcutManager::instance()->shortcuts("contactlist.chat"));
+
+		mucLeaveAction_ = new IconAction(tr("Leave"), this, "psi/action_muc_leave");
+		connect(mucLeaveAction_, SIGNAL(triggered()), SLOT(mucLeave()));
+		mucLeaveAction_->setShortcuts(ShortcutManager::instance()->shortcuts("common.close"));
+
+		if (!contact_->isConference()) {
+			menu_->addAction(addAuthAction_);
+			menu_->addAction(transportLogonAction_);
+			menu_->addAction(transportLogoffAction_);
+			menu_->addSeparator();
+			menu_->addAction(receiveIncomingEventAction_);
+			menu_->addSeparator();
+			msgMenu_ = menu_->addMenu(IconsetFactory::icon("psi/sendMessage").icon(), tr("Send &Message"));
+			msgMenu_->addAction(sendMessageAction_);
+			msgMenu_->addMenu(sendMessageToMenu_);
+			msgMenu_->addAction(openChatAction_);
+			msgMenu_->addMenu(openChatToMenu_);
+			menu_->addAction(openWhiteboardAction_);
+			menu_->addMenu(openWhiteboardToMenu_);
+			menu_->addMenu(executeCommandMenu_);
+			menu_->addMenu(activeChatsMenu_);
+			if(AvCallManager::isSupported()) {
+				menu_->addAction(voiceCallAction_);
+			}
+			menu_->addSeparator();
+			menu_->addAction(sendFileAction_);
+			menu_->addMenu(inviteToGroupchatMenu_);
+			menu_->addSeparator();
+			mngMenu_ = menu_->addMenu(IconsetFactory::icon("psi/manageContact").icon(), tr("Manage &Contact"));
+			mngMenu_->addAction(renameAction_);
+			mngMenu_->addMenu(groupMenu_);
+			authMenu_ = mngMenu_->addMenu(tr("&Authorization"));
+			authMenu_->addAction(authResendAction_);
+			authMenu_->addAction(authRerequestAction_);
+			authMenu_->addAction(authRemoveAction_);
+			mngMenu_->addAction(removeAction_);
+			menu_->addAction(customStatusAction_);
+			menu_->addSeparator();
+			pictureMenu_ = mngMenu_->addMenu(tr("&Picture"));
+			pictureMenu_->addAction(pictureAssignAction_);
+			pictureMenu_->addAction(pictureClearAction_);
+			mngMenu_->addAction(gpgAssignKeyAction_);
+			mngMenu_->addAction(gpgUnassignKeyAction_);
+			menu_->addAction(vcardAction_);
+			menu_->addAction(historyAction_);
+			updateActions();
+		}
+		else {
+			menu_->addAction(mucHideAction_);
+			menu_->addAction(mucShowAction_);
+			menu_->addAction(mucLeaveAction_);
+			menu_->addSeparator();
+			menu_->addAction(customStatusAction_);
 		}
-		menu_->addSeparator();
-		menu_->addAction(sendFileAction_);
-		menu_->addMenu(inviteToGroupchatMenu_);
-		menu_->addSeparator();
-		mngMenu_ = menu_->addMenu(IconsetFactory::icon("psi/manageContact").icon(), tr("Manage &Contact"));
-		mngMenu_->addAction(renameAction_);
-		mngMenu_->addMenu(groupMenu_);
-		authMenu_ = mngMenu_->addMenu(tr("&Authorization"));
-		authMenu_->addAction(authResendAction_);
-		authMenu_->addAction(authRerequestAction_);
-		authMenu_->addAction(authRemoveAction_);
-		mngMenu_->addAction(removeAction_);
-		menu_->addAction(customStatusAction_);
-		menu_->addSeparator();
-		pictureMenu_ = mngMenu_->addMenu(tr("&Picture"));
-		pictureMenu_->addAction(pictureAssignAction_);
-		pictureMenu_->addAction(pictureClearAction_);
-		mngMenu_->addAction(gpgAssignKeyAction_);
-		mngMenu_->addAction(gpgUnassignKeyAction_);
-		menu_->addAction(vcardAction_);
-		menu_->addAction(historyAction_);
 #endif
-
-		updateActions();
 	}
 
 private slots:
@@ -463,7 +490,7 @@ private slots:
 
 	void updateActions()
 	{
-		if (!contact_)
+		if (!contact_ or contact_->isConference())
 			return;
 
 #ifdef YAPSI
@@ -549,6 +576,30 @@ private slots:
 	}
 #endif
 
+
+	void mucHide()
+	{
+		GCMainDlg *gc = contact_->account()->findDialog<GCMainDlg*>(contact_->jid());
+		if (gc && (gc->isTabbed() || !gc->isHidden()))
+			gc->hideTab();
+	}
+
+	void mucShow()
+	{
+		GCMainDlg *gc = contact_->account()->findDialog<GCMainDlg*>(contact_->jid());
+		if (gc) {
+			gc->ensureTabbedCorrectly();
+			gc->bringToFront();
+		}
+	}
+
+	void mucLeave()
+	{
+		GCMainDlg *gc = contact_->account()->findDialog<GCMainDlg*>(contact_->jid());
+		if (gc)
+			gc->close();
+	}
+
 	void rename()
 	{
 		if (!contact_)
--- a/src/tabs/tabbablewidget.cpp
+++ b/src/tabs/tabbablewidget.cpp
@@ -50,6 +50,9 @@ void TabbableWidget::ensureTabbedCorrectly()
 		if (!isTabbed()) {
 			tabManager_->getTabs(this)->addTab(this);
 		}
+		else {
+			QTimer::singleShot(0, tabManager_->getTabs(this), SLOT(showTabWithoutActivation()));
+		}
 	}
 	else {
 		if (PsiOptions::instance()->getOption("options.ui.tabs.tab-singles").toString().contains(tabManager_->tabKind(this))) {
@@ -226,3 +229,11 @@ const QIcon &TabbableWidget::icon() const
 {
 	return icon_;
 }
+
+void TabbableWidget::hideTab()
+{
+	if(isTabbed())
+		getManagingTabDlg()->hideTab(this);
+	else
+		hide();
+}
--- a/src/tabs/tabbablewidget.h
+++ b/src/tabs/tabbablewidget.h
@@ -78,6 +78,7 @@ public slots:
 	virtual void activated();
 	void bringToFront(bool raiseWindow = true);
 	virtual void ensureTabbedCorrectly();
+	void hideTab();
 
 protected:
 	virtual void setJid(const Jid&);
--- a/src/tabs/tabdlg.cpp
+++ b/src/tabs/tabdlg.cpp
@@ -260,6 +260,7 @@ void TabDlg::showTabMenu(int tab, QPoint pos, QContextMenuEvent * event)
 
 	if (tab != -1) {
 		QAction *d = 0;
+		QAction *h = tabMenu_->addAction(tr("Hide Tab"));
 		if(userManagement_) {
 			d = tabMenu_->addAction(tr("Detach Tab"));
 		}
@@ -288,6 +289,9 @@ void TabDlg::showTabMenu(int tab, QPoint pos, QContextMenuEvent * event)
 		else if (act == d) {
 			detachTab(getTab(tab));
 		}
+		else if(act == h) {
+			hideTab(getTab(tab));
+		}
 		else {
 			TabDlg* target = sentTos[act];
 			if (target)
@@ -299,6 +303,8 @@ void TabDlg::showTabMenu(int tab, QPoint pos, QContextMenuEvent * event)
 void TabDlg::tab_aboutToShowMenu(QMenu *menu)
 {
 	menu->addSeparator();
+	menu->addAction(tr("Hide Current Tab"), this, SLOT(hideCurrentTab()));
+	menu->addAction(tr("Hide All Tabs"), this, SLOT(hideAllTab()));
 	menu->addAction(tr("Detach Current Tab"), this, SLOT(detachCurrentTab()));
 	menu->addAction(tr("Close Current Tab"), this, SLOT(closeCurrentTab()));
 
@@ -420,6 +426,22 @@ void TabDlg::showTabWithoutActivation()
 	showWithoutActivation();
 }
 
+void TabDlg::hideCurrentTab()
+{
+	hideTab(static_cast<TabbableWidget*>(tabWidget_->currentPage()));
+}
+
+void TabDlg::hideTab(TabbableWidget* tab)
+{
+	closeTab(tab, false);
+}
+
+void TabDlg::hideAllTab()
+{
+	foreach(TabbableWidget* tab, tabs_)
+		hideTab(tab);
+}
+
 void TabDlg::detachCurrentTab()
 {
 	detachTab(static_cast<TabbableWidget*>(tabWidget_->currentPage()));
@@ -474,6 +496,7 @@ void TabDlg::closeTab(TabbableWidget* chat, bool doclose)
 	chat->hide();
 	removeTabWithNoChecks(chat);
 	chat->setParent(0);
+	chat->deactivated();
 	if (tabWidget_->count() > 0) {
 		updateCaption();
 	}
@@ -496,6 +519,10 @@ void TabDlg::checkHasChats()
 {
 	if (tabWidget_->count() > 0 || this != window())
 		return;
+	if (tabs_.count() > 0) {
+		hide();
+		return;
+	}
 	deleteLater();
 }
 
@@ -548,8 +575,13 @@ void TabDlg::closeEvent(QCloseEvent* closeEvent)
 			return;
 		}
 	}
-	foreach(TabbableWidget* tab, tabs_) {
-		closeTab(tab);
+	if(PsiOptions::instance()->getOption("options.ui.chat.hide-when-closing").toBool()) {
+		hide();
+	}
+	else {
+		foreach(TabbableWidget* tab, tabs_) {
+			closeTab(tab);
+		}
 	}
 }
 
--- a/src/tabs/tabdlg.h
+++ b/src/tabs/tabdlg.h
@@ -122,6 +122,9 @@ public slots:
 	void detachTab(TabbableWidget*);
 	void sendTabTo(TabbableWidget*, TabDlg *);
 	void tabCloseRequested(int i);
+	void hideTab(TabbableWidget*);
+	void hideCurrentTab();
+	void hideAllTab();
 
 signals:
 	void resized(QSize size);
--- a/src/userlist.cpp
+++ b/src/userlist.cpp
@@ -297,8 +297,11 @@ UserListItem::UserListItem(bool self)
 	v_inList = false;
 	v_self = self;
 	v_private = false;
+	v_isConference = false;
 	v_avatarFactory = NULL;
 	lastmsgtype = -1;
+	v_pending = 0;
+	v_hPending = 0;
 }
 
 UserListItem::~UserListItem()
@@ -407,6 +410,32 @@ bool UserListItem::isTransport() const
 	return v_isTransport;
 }
 
+bool UserListItem::isConference() const
+{
+	return v_isConference;
+}
+
+void UserListItem::setConference(bool b)
+{
+	v_isConference = b;
+}
+
+void UserListItem::setPending(int p, int h)
+{
+	v_pending = p;
+	v_hPending = h;
+}
+
+QString UserListItem::pending() const
+{
+	QString str;
+	if (v_hPending)
+		str = QString("[%1/%2]").arg(v_pending).arg(v_hPending);
+	else if (v_pending)
+		str = QString("[%1]").arg(v_pending);
+	return str;
+}
+
 bool UserListItem::isAvailable() const
 {
 	return !v_url.isEmpty();
@@ -523,7 +552,7 @@ QString UserListItem::makeBareTip(bool trim, bool doLinkify) const
 		str += QString("<div style='white-space:pre'>%1</div>").arg(TextUtil::escape(nick));
 
 	// subscription
-	if(!v_self && subscription().type() != Subscription::Both)
+	if(!v_self && !v_isConference && subscription().type() != Subscription::Both)
 		str += QString("<div style='white-space:pre'>") + QObject::tr("Subscription") + ": " + subscription().toString() + "</div>";
 
 	if(!v_keyID.isEmpty())
@@ -627,7 +656,7 @@ QString UserListItem::makeBareTip(bool trim, bool doLinkify) const
 			}
 
 			// MUC
-			if(r.status().hasMUCItem()) {
+			if(!v_isConference && r.status().hasMUCItem()) {
 				if(!r.status().mucItem().jid().isEmpty())
 					str += QString("<div style='white-space:pre'>") + QObject::tr("JID: %1").arg(JIDUtil::toString(r.status().mucItem().jid(),true)) + QString("</div>");
 				if(r.status().mucItem().role() != MUCItem::NoRole)
--- a/src/userlist.h
+++ b/src/userlist.h
@@ -110,6 +110,7 @@ public:
 
 	bool inList() const;
 	bool isTransport() const;
+	bool isConference() const;
 	bool isAvailable() const;
 	bool isHidden() const;
 	bool isAway() const;
@@ -126,6 +127,7 @@ public:
 	QStringList clients() const;
 	QString findClient(QString name) const;
 	const Activity& activity() const;
+	QString pending() const;
 
 	void setJid(const XMPP::Jid &);
 	void setInList(bool);
@@ -135,6 +137,8 @@ public:
 	void setMood(const Mood&);
 	void setActivity(const Activity&);
 	void setTune(const QString&);
+	void setConference(bool);
+	void setPending(int p, int h);
 	const QString& tune() const;
 	void setGeoLocation(const GeoLocation&);
 	const GeoLocation& geoLocation() const;
@@ -154,12 +158,12 @@ public:
 	void setPublicKeyID(const QString &);
 
 private:
-	int lastmsgtype;
+	int lastmsgtype, v_pending, v_hPending;
 	bool v_inList;
 	QDateTime v_t;
 	UserResourceList v_url;
 	QString v_perr;
-	bool v_self, v_isTransport;
+	bool v_self, v_isTransport, v_isConference;
 	bool v_private;
 	QStringList secList;
 	QString v_keyID;
